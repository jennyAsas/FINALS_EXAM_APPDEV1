<div class="safety-feed-container">
  <h2>Real-Time Safety Feed</h2>
  <p>View approved incident reports in real-time.</p>

  <!-- Search Bar -->
  <div class="search-container">
    <div class="search-wrapper">
      <svg
        class="search-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input
        type="text"
        class="report-search-input"
        placeholder="Search by location, keyword, or date..."
        [value]="searchQuery.value"
        (input)="onSearchChange($event.target.value)"
        aria-label="Search incident reports"
      />
      <button
        *ngIf="searchQuery.value"
        class="clear-search-btn"
        (click)="clearSearch()"
        title="Clear search"
        aria-label="Clear search"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Scrollable Reports Container -->
  <div class="feed-wrapper" *ngIf="filteredReports$ | async as reports; else loading">
    <div class="feed-list">
      <ng-container *ngIf="reports.length > 0; else emptyFeed">
        <div *ngFor="let report of reports" class="feed-item approved">
          <div class="item-header">
            <h3>{{ report.description }}</h3>
            <span class="status-badge">{{ report.status }}</span>
          </div>

          <div class="item-details">
            <p><strong>Location:</strong> {{ report.street }}, {{ report.barangay }}</p>
            <p><strong>Reporter:</strong> {{ report.reporterName || report.reporterId }}</p>
            <p><strong>Reported:</strong> {{ report.createdAt | date: 'short' }}</p>
          </div>

          <div *ngIf="report.imageUrl" class="item-image">
            <img [src]="report.imageUrl" alt="Incident" />
          </div>
        </div>
      </ng-container>

      <ng-template #emptyFeed>
        <div class="empty-feed">
          <p *ngIf="searchQuery.value">No incidents match your search. Try different keywords.</p>
          <p *ngIf="!searchQuery.value">No incidents reported at this time. Stay safe!</p>
        </div>
      </ng-template>
    </div>
  </div>

  <ng-template #loading>
    <div class="loading">Loading safety feed...</div>
  </ng-template>
</div>
