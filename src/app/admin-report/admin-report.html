<div class="admin-report-container">
  <h2>Issue Police Alert</h2>
  <p class="subtitle">This alert will be published immediately.</p>

  <ng-container *ngIf="authService.currentUser$ | async as user; else notLogged">
    <form (ngSubmit)="onSubmit()" #reportForm="ngForm">
      <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>
      <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>

      <!-- Admin Info Banner -->
      <div class="admin-info-banner">
        <div class="badge-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 6c1.4 0 2.8 1.1 2.8 2.5V11c.6.3 1 .9 1 1.5v3c0 1-.8 1.8-1.8 1.8h-4c-1 0-1.8-.8-1.8-1.8v-3c0-.6.4-1.2 1-1.5V9.5C9.2 8.1 10.6 7 12 7zm0 1.2c-.8 0-1.5.5-1.5 1.3v1.5h3V9.5c0-.8-.7-1.3-1.5-1.3z"
            />
          </svg>
        </div>
        <div class="badge-text">
          <strong>Police Admin Report</strong>
          <span>Submitted by: Police Admin</span>
        </div>
      </div>

      <!-- Alert Details -->
      <div class="form-section">
        <h3 class="section-title">Alert Details</h3>

        <div class="form-group">
          <label for="description">Description *</label>
          <textarea
            id="description"
            name="description"
            [(ngModel)]="description"
            rows="5"
            required
            placeholder="Provide a detailed description of the incident..."
          ></textarea>
          <span *ngIf="validationErrors['description']" class="error-text">
            {{ validationErrors['description'] }}
          </span>
        </div>

        <div class="form-group">
          <label for="priority">Priority *</label>
          <select id="priority" name="priority" [(ngModel)]="priority" required>
            <option value="high">Urgent</option>
            <option value="medium">Important</option>
            <option value="low">Advisory</option>
          </select>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <h3 class="section-title">Location</h3>

        <!-- Interactive Map Picker -->
        <div class="form-group map-picker-group">
          <label>Pin Location *</label>
          <p class="help-text">Click on the map or search to select location.</p>
          <app-interactive-location-picker
            [barangayInput]="barangay"
            [streetInput]="street"
            (locationSelected)="onMapLocationSelected($event)"
          ></app-interactive-location-picker>
          <div *ngIf="location" class="location-confirmed-badge">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span
              >Location saved: {{ location.lat.toFixed(5) }}, {{ location.lng.toFixed(5) }}</span
            >
          </div>
          <span *ngIf="validationErrors['location']" class="error-text">
            {{ validationErrors['location'] }}
          </span>
        </div>

        <!-- Location Hierarchy Display -->
        <div class="location-hierarchy">
          <div class="hierarchy-label">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>Philippines > Benguet > Baguio City</span>
          </div>
        </div>

        <!-- Barangay -->
        <div class="form-group barangay-group">
          <label for="barangay">Barangay *</label>
          <input
            id="barangay"
            type="text"
            name="barangay"
            [(ngModel)]="barangay"
            (input)="filterBarangays($event)"
            (focus)="showBarangaySuggestions = true"
            (blur)="showBarangaySuggestions = false"
            required
            placeholder="Type to search barangay..."
            autocomplete="off"
          />
          <div
            *ngIf="showBarangaySuggestions && filteredBarangays.length > 0"
            class="barangay-suggestions"
            (mousedown)="$event.preventDefault()"
          >
            <div
              *ngFor="let brgy of filteredBarangays.slice(0, 8)"
              class="suggestion-item"
              (click)="selectBarangay(brgy)"
            >
              {{ brgy }}
            </div>
            <div *ngIf="filteredBarangays.length > 8" class="suggestion-more">
              + {{ filteredBarangays.length - 8 }} more results
            </div>
          </div>
          <span *ngIf="validationErrors['barangay']" class="error-text">
            {{ validationErrors['barangay'] }}
          </span>
        </div>

        <!-- Street -->
        <div class="form-group">
          <label for="street">Street *</label>
          <input
            id="street"
            type="text"
            name="street"
            [(ngModel)]="street"
            required
            placeholder="Enter street or purok..."
          />
          <span *ngIf="validationErrors['street']" class="error-text">
            {{ validationErrors['street'] }}
          </span>
        </div>

        <!-- Landmark -->
        <div class="form-group">
          <label for="landmark">Landmark (Optional)</label>
          <input
            id="landmark"
            type="text"
            name="landmark"
            [(ngModel)]="landmark"
            placeholder="e.g., Near Burnham Park, SM Baguio"
          />
        </div>
        <!-- Photo Upload -->
        <div class="form-group">
          <label for="photo">Attach Photo (Optional)</label>
          <input id="photo" type="file" accept="image/*" (change)="onFileSelected($event)" />
          <div *ngIf="imagePreview" class="photo-preview">
            <img [src]="imagePreview" alt="Photo preview" />
            <button type="button" class="remove-photo-btn" (click)="removePhoto()">
              Remove Photo
            </button>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="button-group">
        <button type="submit" [disabled]="isLoading" class="submit-btn">
          {{ isLoading ? 'Issuing Alert...' : 'Issue Safety Alert' }}
        </button>

        <a routerLink="/admin-dashboard" class="cancel-btn"> Cancel </a>
      </div>
    </form>
  </ng-container>

  <ng-template #notLogged>
    <div class="not-logged">
      <p class="login-warning">You must be signed in as admin to create reports.</p>
      <div class="action-row">
        <a class="btn login-btn" href="/login">Sign In</a>
      </div>
    </div>
  </ng-template>
</div>
